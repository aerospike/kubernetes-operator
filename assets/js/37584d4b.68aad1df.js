"use strict";(self.webpackChunkwebsite_operator=self.webpackChunkwebsite_operator||[]).push([[9542],{2693:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return d}});var o=r(3117),n=r(102),a=(r(7294),r(3905)),s=["components"],i={title:"Create Aerospike Cluster",description:"Create Aerospike Cluster"},l=void 0,p={unversionedId:"Create-Aerospike-cluster",id:"Create-Aerospike-cluster",isDocsHomePage:!1,title:"Create Aerospike Cluster",description:"Create Aerospike Cluster",source:"@site/docs/Create-Aerospike-cluster.md",sourceDirName:".",slug:"/Create-Aerospike-cluster",permalink:"/kubernetes-operator/next/Create-Aerospike-cluster",editUrl:"https://github.com/aerospike/kubernetes-operator/edit/main/docs/Create-Aerospike-cluster.md",tags:[],version:"current",frontMatter:{title:"Create Aerospike Cluster",description:"Create Aerospike Cluster"},sidebar:"docsSidebar",previous:{title:"Install the Operator On Kubernetes",permalink:"/kubernetes-operator/next/Install-the-Operator-on-Kubernetes"},next:{title:"Connect To The Aerospike Cluster",permalink:"/kubernetes-operator/next/Connect-to-the-Aerospike-cluster"}},c=[{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"Prepare the Aerospike Cluster Configuration",id:"prepare-the-aerospike-cluster-configuration",children:[],level:2},{value:"Configure Persistent Storage",id:"configure-persistent-storage",children:[],level:2},{value:"Create Secrets",id:"create-secrets",children:[],level:2},{value:"Create Aerospike Cluster Custom Resource (CR)",id:"create-aerospike-cluster-custom-resource-cr",children:[],level:2},{value:"Deploy the Aerospike Cluster",id:"deploy-the-aerospike-cluster",children:[],level:2},{value:"Verify Cluster Status",id:"verify-cluster-status",children:[],level:2}],u={toc:c};function d(e){var t=e.components,r=(0,n.Z)(e,s);return(0,a.kt)("wrapper",(0,o.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"To deploy the Aerospike cluster using the Operator, you will create an Aerospike custom resource file, which describes the cluster (including its number of nodes, the Aerospike configuration, system resources, etc.). You will then apply that configuration file to your Kubernetes cluster(s)."),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("p",null,"Before deploying your Aerospike cluster, you must ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes-operator/next/Install-the-Operator-on-Kubernetes"},"install the Aerospike Kubernetes Operator")," on your Kubernetes cluster(s)."),(0,a.kt)("p",null,"In order to follow along with this guide, download a copy of the Aerospike Kubernetes Operator GitHub repo (",(0,a.kt)("inlineCode",{parentName:"p"},"aerospike-kubernetes-operator"),") to your local computer. The repo contains scripts and other files which are used throughout this documentation as examples."),(0,a.kt)("p",null,"Either clone this repo or download the ZIP file to your computer ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/aerospike/aerospike-kubernetes-operator"},"from the GitHub page")),(0,a.kt)("h2",{id:"prepare-the-aerospike-cluster-configuration"},"Prepare the Aerospike Cluster Configuration"),(0,a.kt)("p",null,"The Aerospike Kubernetes Operator GitHub repo contains example YAML configuration files for the cluster deployment. These files are located in the ",(0,a.kt)("inlineCode",{parentName:"p"},"aerospike-kubernetes-operator/config/samples")," directory."),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"The following commands include file paths which are relative to the ",(0,a.kt)("inlineCode",{parentName:"p"},"aerospike-kubernetes-operator")," directory. Be sure to either cd into this directory before you run the commands, or edit the command to include the correct file path for your system."))),(0,a.kt)("p",null,"The use case for your cluster will help you to determine which configuration parameters you need to set in the custom resource (CR) file. Identify your requirements for storage, if you plan to ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes-operator/next/XDR"},"enable XDR"),", or ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes-operator/next/Manage-TLS-Certificates"},"manage TLS certificates")," for network security with your Aerospike clusters."),(0,a.kt)("h2",{id:"configure-persistent-storage"},"Configure Persistent Storage"),(0,a.kt)("p",null,"The Aerospike Operator is designed to work with dynamically-provisioned storage classes. Aerospike Server pods may have different storage volumes associated with each service."),(0,a.kt)("p",null,"Persistent storage on the pods will use these storage class provisioners to provision storage."),(0,a.kt)("p",null,"Apply a sample storage class based on your Kubernetes environment:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"EKS: ",(0,a.kt)("inlineCode",{parentName:"li"},"kubectl apply -f config/samples/storage/eks_ssd_storage_class.yaml")),(0,a.kt)("li",{parentName:"ul"},"GCE: ",(0,a.kt)("inlineCode",{parentName:"li"},"kubectl apply -f config/samples/storage/gce_ssd_storage_class.yaml")),(0,a.kt)("li",{parentName:"ul"},"Microk8s: ",(0,a.kt)("inlineCode",{parentName:"li"},"kubectl apply -f config/samples/storage/microk8s_filesystem_storage_class.yaml"))),(0,a.kt)("p",null,"See ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes-operator/next/Storage-provisioning"},"Storage Provisioning")," for more details on configuring persistent storage."),(0,a.kt)("h2",{id:"create-secrets"},"Create Secrets"),(0,a.kt)("p",null,"Next, create Secrets to set up features like the license file (",(0,a.kt)("inlineCode",{parentName:"p"},"features.conf"),"), Aerospike authentication, TLS, and the cluster admin password. See the ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes-operator/next/Manage-TLS-Certificates"},"Manage TLS Certificates")," section for more details."),(0,a.kt)("p",null,"The example ",(0,a.kt)("inlineCode",{parentName:"p"},"config/samples/secrets")," directory includes a collection of example TLS certificates, security credentials, and more. Apply these files as a Kubernetes Secret:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl  -n aerospike create secret generic aerospike-secret --from-file=config/samples/secrets\n")),(0,a.kt)("p",null,"Create a Secrets containing the password for Aerospike cluster admin:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl  -n aerospike create secret generic auth-secret --from-literal=password='admin123'\n")),(0,a.kt)("h2",{id:"create-aerospike-cluster-custom-resource-cr"},"Create Aerospike Cluster Custom Resource (CR)"),(0,a.kt)("p",null,"Refer to the ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes-operator/next/Cluster-configuration-settings"},"cluster configuration settings")," for details on the Aerospike cluster custom resource (CR) file. Sample Aerospike cluster CR files for different configurations can be found in the ",(0,a.kt)("inlineCode",{parentName:"p"},"aerospike-kubernetes-operator/config/samples")," directory."),(0,a.kt)("p",null,"You can edit this file at any time to make changes and manage the Aerospike cluster."),(0,a.kt)("h2",{id:"deploy-the-aerospike-cluster"},"Deploy the Aerospike Cluster"),(0,a.kt)("p",null,"Use the custom resource YAML file you created to deploy an Aerospike cluster. If you don't have a custom resource file, you can choose one of the sample files in the ",(0,a.kt)("inlineCode",{parentName:"p"},"config/samples")," directory."),(0,a.kt)("p",null,"For example, to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"config/samples/dim_nostorage_cluster_cr.yaml")," file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl apply -f config/samples/dim_nostorage_cluster_cr.yaml\n")),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Replace the file name with the custom resource YAML file for your cluster."))),(0,a.kt)("h2",{id:"verify-cluster-status"},"Verify Cluster Status"),(0,a.kt)("p",null,"Use ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get statefulset -n aerospike")," to ensure the aerospike-kubernetes-operator creates the StatefulSets for the custom resource."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ kubectl get statefulset -n aerospike\nNAME      READY   AGE\naerocluster-0   2/2     24s\n")),(0,a.kt)("p",null,"Use ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pods -n aerospike")," to check the pods to confirm the status. This step may take time as the pods provision resources, initialize, and are ready. Please wait for the pods to switch to the Running state before you continue."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ kubectl get pods -n aerospike\nNAME          READY   STATUS      RESTARTS   AGE\naerocluster-0-0     1/1     Running     0          48s\naerocluster-0-1     1/1     Running     0          48s\n")),(0,a.kt)("p",null,"If the Aerospike cluster pods do not switch to Running status in a few minutes, please refer to the ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes-operator/next/Troubleshooting"},"Troubleshooting Guide"),"."))}d.isMDXComponent=!0},3905:function(e,t,r){r.d(t,{Zo:function(){return c},kt:function(){return m}});var o=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=o.createContext({}),p=function(e){var t=o.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(r),m=n,k=d["".concat(l,".").concat(m)]||d[m]||u[m]||a;return r?o.createElement(k,s(s({ref:t},c),{},{components:r})):o.createElement(k,s({ref:t},c))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,s=new Array(a);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:n,s[1]=i;for(var p=2;p<a;p++)s[p]=r[p];return o.createElement.apply(null,s)}return o.createElement.apply(null,r)}d.displayName="MDXCreateElement"}}]);